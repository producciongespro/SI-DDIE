import React, {useState, useEffect} from 'react';
import alertify from 'alertifyjs';
import 'alertifyjs/build/css/alertify.min.css';
import 'alertifyjs/build/css/themes/default.min.css';
import Tabla from './Tabla';
import enviar from '../modulos/enviar';
// import loadingGif from '../assets/img/loading1.gif';

import mostrarAlerta from './Alerta.js';

import referenciasJson from '../data/referencias.json';
const referencias = referenciasJson[0];


function Papelera () {     
    const [datosJson, setDatosJson ] = useState(null);

  useEffect(() => {
    obtenerDatos();
  }, [])

  async function obtenerDatos() {    
    let response = await fetch(referencias.consultaeliminados + "?tabla=consultas");    
    const tmpArray = await response.json();
    setDatosJson (tmpArray);     
  }

  const handleRecuperar =(e)=>{
    console.log("e.target.id", e.target.id);
    let idConsulta = e.target.id;
    const data = {
      "borrado" : 1   
      // "id_usuario": 103
    }
    let url = referencias.actualizaconsulta + "?tabla_destino=consultas&id="+idConsulta + "";
    // console.log("url desde submit", url);
    
    enviar(url, data, function (resp) {
      mostrarAlerta("Alerta", resp.msj);
        // alertify
        // .alert( config.nombre, resp.msj, function(){
        //   console.log("ok");          
        // });
        obtenerDatos();
      })
    
  }


    return (
        <div className="container">

        
      <div className="alert alert-primary" role="alert">
        Admin/Papelera
      </div>
      {
          datosJson === null ?
          (
            <div className="row">
              <div className="col-12">
                {/* <img className="img img-fluid" src={loadingGif} alt="Cargando" /> */}
                <span className="spinner-grow spinner-grow-lg text-danger"></span>
                <span className=""> Cargando datos. Por favor espere...</span>
              </div>
            </div>
          ) : 
          (
            <Tabla array={datosJson} clase="table table-dark" modo="papelera" handleRecuperar={handleRecuperar} />
          )
      }


</div>
    )
 }

 export default Papelera;